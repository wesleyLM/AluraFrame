{"version":3,"file":"NegociacaoController.js","names":["NegociacaoController","$","document","querySelector","bind","NegociacaoService","Bind","ListaNegociacoes","NegociacoesView","Mensagem","MensagensView","evento","preventDefault","negociacao","cadastrar","then","mensagem","adiciona","texto","erro","apagar","coluna","inverteOrdem","ordenar","a","b","listar","negociacoes","forEach","setInterval","addEventListener","e","target","nodeName","ordena","textContent","toLowerCase","Negociacao","DateHelper","textoParaData","value","parseInt","parseFloat","importar","reset","focus","negociacaoController","currentInstanced"],"sources":["../../app-es6/controllers/NegociacaoController.js"],"sourcesContent":["import { Negociacao } from \"../models/Negociacao.js\";\r\nimport { NegociacaoService } from \"../services/NegociacaoService.js\";\r\nimport { Bind } from \"../helpers/Bind.js\";\r\nimport { ListaNegociacoes } from \"../models/ListaNegociacoes.js\";\r\nimport { NegociacoesView } from \"../views/NegociacoesView.js\";\r\nimport { MensagensView } from \"../views/MensagensView.js\";\r\nimport { Mensagem } from \"../models/Mensagem.js\";\r\nimport { DateHelper } from \"../helpers/DateHelper.js\";\r\n\r\nclass NegociacaoController {\r\n    #inputData;\r\n    #inputQuantidade;\r\n    #inputValor;\r\n    #form;\r\n    #listaNegociacoes;\r\n    #mensagem;\r\n    #ordemAtual;\r\n    #service;\r\n    #table;\r\n\r\n    constructor() {\r\n        let $ = document.querySelector.bind(document);\r\n\r\n        this.#form = $('.form');\r\n        this.#inputData = $('#data');\r\n        this.#inputQuantidade = $('#quantidade');\r\n        this.#inputValor = $('#valor');\r\n        this.#service = new NegociacaoService()\r\n\r\n        this.#listaNegociacoes = new Bind(\r\n            new ListaNegociacoes(),\r\n            new NegociacoesView($(\"[data-tabela]\")),\r\n            'adiciona', 'apagar', 'ordenar', 'inverteOrdem'\r\n        )\r\n\r\n        this.#mensagem = new Bind(\r\n            new Mensagem(),\r\n            new MensagensView($(\"[data-mensagem]\")),\r\n            'texto'\r\n        )\r\n\r\n        this.#ordemAtual = ''\r\n        this.#table = $('[data-table]');\r\n\r\n        this.#init()\r\n\r\n    }\r\n\r\n    #init(){\r\n\r\n        this.#service\r\n            .listar()\r\n            .then(negociacoes => \r\n                negociacoes.forEach(negociacao => \r\n                this.#listaNegociacoes.adiciona(negociacao)))\r\n            .catch(erro => this.#mensagem.texto = erro)\r\n\r\n        \r\n    \r\n        setInterval(()=>{\r\n            this.#importaNegociacoes()\r\n            this.#table.addEventListener('click',e => {\r\n                if(e.target.nodeName == \"TH\"){\r\n                    this.ordena(e.target.textContent.toLowerCase())\r\n                }\r\n            })\r\n        },3000)\r\n        \r\n        \r\n    }\r\n\r\n    adiciona(evento) {\r\n        evento.preventDefault();\r\n\r\n        let negociacao = this.#criarNegociacao();\r\n\r\n        this.#service\r\n            .cadastrar(negociacao)\r\n            .then(mensagem =>{\r\n    \r\n                this.#listaNegociacoes.adiciona(negociacao)\r\n                this.#limpaCampo();\r\n                this.#mensagem.texto = mensagem\r\n            })\r\n            .catch(erro => this.#mensagem.texto = erro)\r\n    }\r\n\r\n    #criarNegociacao() {\r\n        return new Negociacao(\r\n            DateHelper.textoParaData(this.#inputData.value), \r\n            parseInt(this.#inputQuantidade.value),\r\n            parseFloat(this.#inputValor.value))\r\n    }\r\n\r\n    #importaNegociacoes() {\r\n        this.#service\r\n            .importar(this.#listaNegociacoes)\r\n            .then(negociacoes => {\r\n                negociacoes.forEach(negociacao => \r\n                    this.#listaNegociacoes.adiciona(negociacao))\r\n                        \r\n                this.#mensagem.texto = \"Negociações importadas com sucesso\"\r\n            }) \r\n            .catch(erro => this.#mensagem.texto = erro);\r\n    }\r\n\r\n    limpaTabela() {\r\n\r\n        this.#service\r\n            .apagar()\r\n            .then(mensagem =>{ \r\n                this.#listaNegociacoes.apagar()\r\n    \r\n                this.#mensagem.texto = mensagem\r\n            })\r\n            .catch(erro => this.#mensagem.texto = erro)  \r\n    }\r\n\r\n    #limpaCampo() {\r\n        this.#form.reset();\r\n        this.#inputData.focus();\r\n    }\r\n\r\n    ordena(coluna) {\r\n        if (this.#ordemAtual == coluna) {\r\n            this.#listaNegociacoes.inverteOrdem()\r\n        } else {\r\n            this.#listaNegociacoes.ordenar((a, b) => a[coluna] - b[coluna]);\r\n        }\r\n        this.#ordemAtual = coluna;\r\n    }\r\n\r\n}\r\n\r\nlet negociacaoController = new NegociacaoController();\r\n\r\nexport function currentInstanced() {\r\n    return negociacaoController;\r\n}"],"mappings":"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"}