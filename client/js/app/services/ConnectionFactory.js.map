{"version":3,"file":"ConnectionFactory.js","names":["stores","version","dbName","connection","close","ConnectionFactory","Error","Promise","resolve","reject","openRequest","window","indexedDB","open","onupgradeneeded","e","target","result","onsuccess","bind","onerror","console","log","error","name","forEach","store","objectStoreNames","contains","deleteObjectStore","createObjectStore","autoIncrement"],"sources":["../../app-es6/services/ConnectionFactory.js"],"sourcesContent":["const stores = ['negociacoes']\r\nconst version = 1;\r\nconst dbName = 'aluraframe';\r\n\r\nvar connection = null;\r\nvar close = null\r\n\r\nexport class ConnectionFactory{\r\n    \r\n    constructor() {\r\n        throw new Error('Você não pode criar uma instância dessa classe');\r\n    }\r\n\r\n    static getConnection(){\r\n\r\n        return new Promise((resolve,reject)=>{\r\n\r\n            var openRequest = window.indexedDB.open(dbName, version)\r\n    \r\n            openRequest.onupgradeneeded = e => {\r\n                ConnectionFactory.#createStores(e.target.result)\r\n            }\r\n    \r\n            openRequest.onsuccess = e => {\r\n                if(!connection) connection = e.target.result;\r\n                close = connection.close.bind(connection);\r\n                connection.close = function() {\r\n                    throw new Error('A conexão não pode-se fechada diretamente')\r\n                }\r\n                resolve(connection)\r\n            }\r\n    \r\n            openRequest.onerror = e => {                    \r\n                console.log(e.target.error)\r\n\r\n                reject(e.target.error.name)\r\n            }\r\n        })\r\n    }\r\n\r\n    static #createStores(connection){\r\n        stores.forEach(store => {\r\n\r\n            if(connection.objectStoreNames.contains(store)) connection.deleteObjectStore(store);\r\n\r\n            connection.createObjectStore(store, {autoIncrement: true});\r\n        })\r\n    }\r\n\r\n    static closeConnection(){\r\n        if(connection){\r\n            close();\r\n            connection = null;\r\n        }\r\n    }\r\n}\r\n"],"mappings":";;;;;;;;;;;;;;;;;AAAA,IAAMA,MAAM,GAAG,CAAC,aAAD,CAAf;AACA,IAAMC,OAAO,GAAG,CAAhB;AACA,IAAMC,MAAM,GAAG,YAAf;AAEA,IAAIC,UAAU,GAAG,IAAjB;AACA,IAAIC,KAAK,GAAG,IAAZ;;IAEaC,iB;EAET,6BAAc;IAAA;;IACV,MAAM,IAAIC,KAAJ,CAAU,gDAAV,CAAN;EACH;;;;WAED,yBAAsB;MAElB,OAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAASC,MAAT,EAAkB;QAEjC,IAAIC,WAAW,GAAGC,MAAM,CAACC,SAAP,CAAiBC,IAAjB,CAAsBX,MAAtB,EAA8BD,OAA9B,CAAlB;;QAEAS,WAAW,CAACI,eAAZ,GAA8B,UAAAC,CAAC,EAAI;UAC/B,6BAAAV,iBAAiB,EAbpBA,iBAaoB,gBAAjB,MAAAA,iBAAiB,EAAeU,CAAC,CAACC,MAAF,CAASC,MAAxB,CAAjB;QACH,CAFD;;QAIAP,WAAW,CAACQ,SAAZ,GAAwB,UAAAH,CAAC,EAAI;UACzB,IAAG,CAACZ,UAAJ,EAAgBA,UAAU,GAAGY,CAAC,CAACC,MAAF,CAASC,MAAtB;UAChBb,KAAK,GAAGD,UAAU,CAACC,KAAX,CAAiBe,IAAjB,CAAsBhB,UAAtB,CAAR;;UACAA,UAAU,CAACC,KAAX,GAAmB,YAAW;YAC1B,MAAM,IAAIE,KAAJ,CAAU,2CAAV,CAAN;UACH,CAFD;;UAGAE,OAAO,CAACL,UAAD,CAAP;QACH,CAPD;;QASAO,WAAW,CAACU,OAAZ,GAAsB,UAAAL,CAAC,EAAI;UACvBM,OAAO,CAACC,GAAR,CAAYP,CAAC,CAACC,MAAF,CAASO,KAArB;UAEAd,MAAM,CAACM,CAAC,CAACC,MAAF,CAASO,KAAT,CAAeC,IAAhB,CAAN;QACH,CAJD;MAKH,CAtBM,CAAP;IAuBH;;;WAWD,2BAAwB;MACpB,IAAGrB,UAAH,EAAc;QACVC,KAAK;QACLD,UAAU,GAAG,IAAb;MACH;IACJ;;;;;;;;uBAdoBA,U,EAAW;EAC5BH,MAAM,CAACyB,OAAP,CAAe,UAAAC,KAAK,EAAI;IAEpB,IAAGvB,UAAU,CAACwB,gBAAX,CAA4BC,QAA5B,CAAqCF,KAArC,CAAH,EAAgDvB,UAAU,CAAC0B,iBAAX,CAA6BH,KAA7B;IAEhDvB,UAAU,CAAC2B,iBAAX,CAA6BJ,KAA7B,EAAoC;MAACK,aAAa,EAAE;IAAhB,CAApC;EACH,CALD;AAMH"}